<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kammy Music Library</title>
    <link rel="stylesheet" href="https://media.static.leafia.eu/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="https://media.static.leafia.eu/monet/bsmonet.css">
    <link rel="shortcut icon" href="https://media.static.leafia.eu/avatar/round.webp" type="image/webp">
    <script>
        let FF_FOUC_FIX;
    </script>
    <style>
        @font-face {
            src: url("https://media.static.leafia.eu/fonts/AtkinsonHyperlegibleNext-Regular.ttf");
            font-style: normal;
            font-family: 'Atkinson Hyperlegible Next';
        }

        @font-face {
            src: url("https://media.static.leafia.eu/fonts/AtkinsonHyperlegibleNext-Italic.ttf");
            font-style: italic;
            font-family: 'Atkinson Hyperlegible Next';
        }

        body, html {
            font-family: 'Atkinson Hyperlegible Next', Roboto, -apple-system, system-ui, sans-serif;
        }

        .list-group-item-action { cursor: pointer; }
        .badge:not(:last-child) { margin-right: 3px; }
        .badge:not(:first-child) { margin-left: 3px; }
        .badge { color: inherit; }
    </style>
</head>
<body>
    <div id="loader" style="position: fixed; inset: 0; z-index: 999; display: flex; align-items: center; justify-content: center;" class="bg-body">
        <img src="https://media.static.leafia.eu/music/loader.svg" alt="..." style="width: 32px;">
    </div>

    <main id="app" style="display: none;">
        <div class="container mt-5">
            <h1>Kammy Music Library</h1>

            <p id="count"></p>

            <div class="alert alert-secondary">While I put my best efforts toward giving
                you the highest quality covers and music works possible, you might still encounter covers with corrupted
                or missing audio. There is unfortunately nothing I can do about this as it means the original files
                have been lost and corrupted.
                <a href="https://kammyfur.notion.site/1c1776ba5caa8046903cc62a61714be1?pvs=105"
                   target="_blank" referrerpolicy="no-referrer">Sign up to get notifications when new releases are published.</a>
            </div>
            <input type="text" class="form-control" style="margin-top: 20px; margin-bottom: 20px;"
                   autofocus placeholder="Filter by name..." id="search" onkeydown="wasm.search();"
                   onkeyup="wasm.search();" onchange="wasm.search();" autocomplete="off">

            <div class="list-group" id="js-data-list"></div>
            <div class="list-group" id="js-data-results" style="display: none;"></div>

            <footer class="small text-muted" style="margin-top: 30px; text-align: center;">
                <p>All songs belong to their original creators, see <a class="link" target="_blank" href="https://leafia.eu">
                    the main website</a> for copyright claims.</p>
                <svg src="https://media.static.leafia.eu/banner.svg"></svg>
            </footer>

            <br><br><br>
        </div>
    </main>

    <div class="modal fade" tabindex="-1" id="player" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div style="display: grid; grid-template-columns: 1fr max-content; grid-gap: 10px; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center;">
                            <div>
                                <h5 class="modal-title"><span id="player-title"></span></h5>
                                <div id="player-author"></div>
                                <div id="player-date"></div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <div style="display: grid; grid-template-columns: max-content max-content; grid-gap: 10px;">
                                <div style="display: flex; align-items: center;" class="text-muted">
                                    <div>
                                        <div id="player-quality">AAC (256 kbps)</div>
                                        <div>Powered by KME</div>
                                    </div>
                                </div>
                                <img id="player-kme" src="https://media.static.leafia.eu/music/kme.webp" alt="Kammy Media Encryption" style="width: 48px;">
                            </div>
                        </div>
                    </div>
                    <audio id="player-el" data-kme-enable controls style="width: 100%;" controlslist="nodownload,nofullscreen,noremoteplayback" disableremoteplayback="yes"></audio>
                </div>
                <div class="modal-footer">
                    <button id="player-modal-close" class="btn btn-secondary">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" tabindex="-1" id="versions" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <h5 class="modal-title">Select a version</h5>
                    <p>Select the version of "<span id="versions-title"></span>" you want to listen to:</p>
                    <div id="versions-list" class="list-group"></div>
                </div>
                <div class="modal-footer">
                    <button onclick="wasm.version_hide();" class="btn btn-secondary">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://media.static.leafia.eu/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="https://media.static.leafia.eu/monet/color.js" type="module"></script>
    <script src="https://media.static.leafia.eu/music/dash.all.min.js" referrerpolicy="no-referrer"></script>
    <script src="/dist/kme.min.js"></script>

    <script type="module">
        import * as wasm from "/dist/engine.js";
        window.wasm = wasm;
        wasm.default();

        (async () => {
            await Promise.all(Array.from(document.querySelectorAll("svg[src]")).map(async (i) => {
                i.outerHTML = await (await fetch(i.getAttribute("src"))).text();
            }));
        })();

        window.modals = {
            version: new bootstrap.Modal(document.getElementById("versions")),
            player: new bootstrap.Modal(document.getElementById("player"))
        }

        window.showModal = (modal) => {
            window.modals[modal].show();
        }

        window.hideModal = (modal) => {
            window.modals[modal].hide();
        }

        window.completeLoad = () => {
            document.getElementById("loader").style.display = "none";
        }

        window.navigate = (url) => {
            location.href = url;
        }

        window.changeURL = (url, replace = false) => {
            if (replace) {
                window.history.replaceState({ "pageTitle": document.title }, "", url);
            } else {
                window.history.pushState({ "pageTitle": document.title }, "", url);
            }
            window.wasm.process_hash();
        }
    </script>
</body>
</html>
